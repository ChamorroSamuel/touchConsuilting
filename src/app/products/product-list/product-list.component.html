<mat-card>
  <mat-card-header class="header-row">
    <mat-card-title>Productos</mat-card-title>
    <button mat-flat-button color="primary" routerLink="/products/new"
    >Nuevo</button>
  </mat-card-header>

  <mat-card-content>
    <div class="filter-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Buscar</mat-label>
        <input
          matInput
          #filterInput
          (keyup)="applyFilter(filterInput.value)"
          placeholder="Filtrar por nombre"
        />
      </mat-form-field>
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Categoría</mat-label>
        <mat-select (selectionChange)="filterByCategory($event.value)">
          <mat-option value="">Todas las categorías</mat-option>
          <mat-option *ngFor="let c of categories" [value]="c">{{ c }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 full-width">
      <!-- Nombre -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Nombre</th>
        <td mat-cell *matCellDef="let p">{{ p.name }}</td>
      </ng-container>

      <!-- Descripción -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Descripción</th>
        <td mat-cell *matCellDef="let p">{{ p.description }}</td>
      </ng-container>

      <!-- Precio -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Precio</th>
        <td mat-cell *matCellDef="let p">S/ {{ p.price }}</td>
      </ng-container>

      <!-- Cantidad -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef>Cantidad</th>
        <td mat-cell *matCellDef="let p">{{ p.quantity }}</td>
      </ng-container>

      <!-- Categoría -->
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef>Categoría</th>
        <td mat-cell *matCellDef="let p">{{ p.category }}</td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let p">
          <button mat-mini-button color="accent" (click)="onEdit(p.id)">Editar</button>
          <button mat-mini-button color="warn" (click)="onDelete(p.id)">Eliminar</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    <div class="button-row">
    <button mat-raised-button color="accent"
            *ngIf="userRole==='Administrador'"
            (click)="downloadReport()">
      Reporte PDF
    </button>
    <!--
    <button mat-raised-button color="primary"
            (click)="downloadAllReport()">
      Descargar Todos (PdfSharpCore)
    </button>
-->
    </div>
    <mat-paginator [pageSize]="5"></mat-paginator>
  </mat-card-content>
</mat-card>
